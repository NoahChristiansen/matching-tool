



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0, mkdocs-material-3.0.3">
    
    
      
        <title>Creating or Modifying a Schema - Matching Tool</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#creating-or-modifying-a-schema" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Matching Tool" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Matching Tool
              </span>
              <span class="md-header-nav__topic">
                Creating or Modifying a Schema
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/dssg/matching-tool/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Github
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Matching Tool" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Matching Tool
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/dssg/matching-tool/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Github
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      For Users
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        For Users
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/using/" title="Using the Tool" class="md-nav__link">
      Using the Tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Schemas
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Schemas
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/booking-akaalias-data/" title="Booking AKA/Alias Schema" class="md-nav__link">
      Booking AKA/Alias Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/booking-charging-data/" title="Booking Charge Schema" class="md-nav__link">
      Booking Charge Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/booking-data/" title="Booking Schema" class="md-nav__link">
      Booking Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/by-name-list/" title="By-Name Schema" class="md-nav__link">
      By-Name Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/case-charge-data/" title="Case Charge Schema" class="md-nav__link">
      Case Charge Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/hmis-akaalias-data/" title="Homelessness Services AKA/Alias Schema" class="md-nav__link">
      Homelessness Services AKA/Alias Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/hmis-data/" title="Homelessness Service Stays Schema" class="md-nav__link">
      Homelessness Service Stays Schema
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      For Administrators
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        For Administrators
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/install/" title="Installing" class="md-nav__link">
      Installing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/updating/" title="Updating" class="md-nav__link">
      Updating
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/matching/" title="Configuring the Matching Service" class="md-nav__link">
      Configuring the Matching Service
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      For Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        For Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Creating or Modifying a Schema
      </label>
    
    <a href="./" title="Creating or Modifying a Schema" class="md-nav__link md-nav__link--active">
      Creating or Modifying a Schema
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creating-or-modifying-a-schema" title="Creating or Modifying a Schema" class="md-nav__link">
    Creating or Modifying a Schema
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modifying-an-existing-schema" title="Modifying an Existing Schema" class="md-nav__link">
    Modifying an Existing Schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-new-schema" title="Creating a new Schema" class="md-nav__link">
    Creating a new Schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limitations-when-creating-a-new-schema" title="Limitations when creating a new Schema" class="md-nav__link">
    Limitations when creating a new Schema
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../webapp/" title="Modifying the Webapp" class="md-nav__link">
      Modifying the Webapp
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../matching/" title="Modifying the Matching Service" class="md-nav__link">
      Modifying the Matching Service
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creating-or-modifying-a-schema" title="Creating or Modifying a Schema" class="md-nav__link">
    Creating or Modifying a Schema
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modifying-an-existing-schema" title="Modifying an Existing Schema" class="md-nav__link">
    Modifying an Existing Schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-new-schema" title="Creating a new Schema" class="md-nav__link">
    Creating a new Schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limitations-when-creating-a-new-schema" title="Limitations when creating a new Schema" class="md-nav__link">
    Limitations when creating a new Schema
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/dssg/matching-tool/edit/master/docs/dev/schemas.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Creating or Modifying a Schema</h1>
                
                <h2 id="creating-or-modifying-a-schema">Creating or Modifying a Schema<a class="headerlink" href="#creating-or-modifying-a-schema" title="Permanent link">&para;</a></h2>
<p>The matching tool can be extended to work with schemas not defined in the initial release. This document defines how this can be done and what limitations are involved.</p>
<h3 id="modifying-an-existing-schema">Modifying an Existing Schema<a class="headerlink" href="#modifying-an-existing-schema" title="Permanent link">&para;</a></h3>
<p>To modify the columns or checks in an existing schema:</p>
<ol>
<li>
<p>Find the schema in <a href="https://github.com/dssg/matching-tool/tree/master/webapp/schemas/uploader">webapp/schemas/uploader/</a>.</p>
</li>
<li>
<p>Modify the name, datatype, or constraints for an individual field, or the 'primaryKey' that should uniquely define each row. If it is not clear how to modify an individual schema to, for instance, express a constraint in a given way, refer to either the <a href="https://github.com/frictionlessdata/goodtables-py">goodtables-py docs</a> (the general library used by the matching tool) or the <a href="https://github.com/dssg/matching-tool/blob/master/webapp/backend/validations/__init__.py">webapp.validations</a> module (the file where custom checks for the matching tool are defined).</p>
</li>
<li>
<p>If any of the column names, data types, or primary key have changed, you will have to delete the installation's master table as this information is encoded in the master table's schema. Refer your administrator to <a href="../../admin/updating/#clearing-a-master-table-for-a-schema">Clearing a Master Table for a Schema</a>.</p>
</li>
</ol>
<h3 id="creating-a-new-schema">Creating a new Schema<a class="headerlink" href="#creating-a-new-schema" title="Permanent link">&para;</a></h3>
<p>To create a new schema:</p>
<ol>
<li>Create a JSON file containing the schema in <a href="https://github.com/dssg/matching-tool/tree/master/webapp/schemas/uploader">webapp/schemas/uploader/</a>, obeying the same name scheme (<code>lowercase-separated-by-dashes.json</code>). Copying an example from one of the existing schemas is recommended. The important parts of the schema:<ul>
<li>The top-level <code>name</code> field simply contains a human-readable name for the schema. This is used in the web UI.</li>
<li>The <code>fields</code> field contains a list of column names, their datatypes, and any necessary constraints on them. If you have questions about standard constraints that are not clear from the existing .json files, refer to the <a href="https://github.com/frictionlessdata/goodtables-py">goodtables-py docs</a> (the general library used by the matching tool). If a field is intended to be matched with a field from existing schemas, <em>use the same field names, types, and constraints</em> for that field from the existing schemas. The matcher will assume that these are formatted similarly, and you can get poor results if this isn't true.</li>
<li>The <code>primaryKey</code> field contains a list of column names that uniquely identify a row in the schema. This is important to get right, as this primary key is enforced in the database. If a new row is uploaded that matches the primary key of an existing row, <em>that row will be updated with the information from the new row</em>. So ensure that you include enough fields from the schema to uniquely identify events of the event type you are concerned with. For instance, the <a href="https://github.com/dssg/matching-tool/blob/master/webapp/schemas/uploader/jail-bookings.json">jail_bookings</a> schema can include different rows for different location changes within the jail. Therefore, it has <code>location_start_date</code> as part of its primaryKey.</li>
</ul>
</li>
<li>(recommended) Update the <a href="https://github.com/dssg/matching-tool/blob/master/webapp/webapp/tests/test_schemas.py">schema test file</a> with the name of this new schema, and run this test to ensure that your schema doesn't have any structural errors. This helps to do up front as otherwise the error will show up as an internal server error when attempting to upload a file.  To test it:<ul>
<li>Install <a href="https://pip.pypa.io/en/stable/installing/">pip</a>.</li>
<li><code>pip install virtualenv</code></li>
<li><code>cd webapp</code></li>
<li><code>virtualenv venv</code></li>
<li><code>source venv/bin/activate</code></li>
<li><code>pip install -r requirements.txt -r requirements_dev.txt</code></li>
<li><code>PYTHONPATH='.' py.test webapp/tests/test_schemas.py</code></li>
</ul>
</li>
<li>Open the <a href="https://github.com/dssg/matching-tool/blob/master/webapp/webapp/validations/__init__.py">webapp.validations</a> module.<ul>
<li>The <code>CHECKS_BY_SCHEMA</code> dictionary is where you should add this schema, and a list of the checks that should be activated.  Simply making it <code>STANDARD_CHECKS</code> is a good start for schemas that are designed to be similar to the shipped schemas. In the basic case, this is all you should have to do in this file.</li>
<li>If you want to add any checks that contain custom logic, you can define them in this file. We will not include a custom check tutorial here, but the examples in that file (any function with the '@check' decorator) and the <a href="https://github.com/frictionlessdata/goodtables-py">goodtables-py docs</a> will be helpful.</li>
</ul>
</li>
<li>Open the <a href="https://github.com/dssg/matching-tool/blob/master/matcher/matcher_config.yaml">matcher config</a> and make any changes needed. Refer to the <a href="../matching/">guide on changing the matching config</a> for details, but of note if there are columns in your new schema that you wish to use for matching that aren't present in existing schemas you will have to add them here and configure how they will be used for matching.</li>
<li>Have your administrator <a href="../../admin/updating/#updating-code">install the new code</a> (new schema+validation file updates), and <a href="../../admin/updating/#-user-and-role-management">add your user to the new event type</a>: the event type will be the name of the .json file, dashes replaced with underscores. Alternately, if you have a local installation you can do those steps yourself.</li>
<li>At this point, you should be able to upload new files for this schema type, the matcher should be able to produce results, and you can download these results with the original source data with match ids in the results dashboard ('Download Source Events', bottom of the left control panel).</li>
</ol>
<h3 id="limitations-when-creating-a-new-schema">Limitations when creating a new Schema<a class="headerlink" href="#limitations-when-creating-a-new-schema" title="Permanent link">&para;</a></h3>
<p>Creating a new schema <em>does not make its events show up on the results dashboard</em>. The logic for populating the Venn diagrams and results table are highly customized for HMIS Service Stays and Jail Bookings. Adding a third event type to this dashboard raises many interface design questions that are not easy to answer. If you wish to customize this interface, you can refer to <a href="../webapp/">Modifying the Webapp</a> but know that at this point your version of the code will be highly customized and it will be tough to receive code updates. It is recommended that you import these source events with match ids into your spreadsheet/reporting tool of choice for visualization.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../admin/matching/" title="Configuring the Matching Service" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Configuring the Matching Service
              </span>
            </div>
          </a>
        
        
          <a href="../webapp/" title="Modifying the Webapp" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Modifying the Webapp
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>