



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.2">
    
    
      
        <title>Installing - Matching Tool</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.ba0fd1a6.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#installing-the-matching-tool" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Matching Tool" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Matching Tool
              </span>
              <span class="md-header-nav__topic">
                Installing
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Matching Tool
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      For Users
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        For Users
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/using/" title="Using the Tool" class="md-nav__link">
      Using the Tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Schemas
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Schemas
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/booking-akaalias-data/" title="Booking AKA/Alias Schema" class="md-nav__link">
      Booking AKA/Alias Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/booking-charging-data/" title="Booking Charge Schema" class="md-nav__link">
      Booking Charge Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/booking-data/" title="Booking Schema" class="md-nav__link">
      Booking Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/by-name-list/" title="By-Name Schema" class="md-nav__link">
      By-Name Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/case-charge-data/" title="Case Charge Schema" class="md-nav__link">
      Case Charge Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/hmis-akaalias-data/" title="Homelessness Services AKA/Alias Schema" class="md-nav__link">
      Homelessness Services AKA/Alias Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/hmis-data/" title="Homelessness Service Stays Schema" class="md-nav__link">
      Homelessness Service Stays Schema
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      For Administrators
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        For Administrators
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Installing
      </label>
    
    <a href="./" title="Installing" class="md-nav__link md-nav__link--active">
      Installing
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing-the-matching-tool" title="Installing the matching-tool" class="md-nav__link">
    Installing the matching-tool
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-with-docker" title="Deploy with Docker" class="md-nav__link">
    Deploy with Docker
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#production" title="Production" class="md-nav__link">
    Production
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development" title="Development" class="md-nav__link">
    Development
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../updating/" title="Updating" class="md-nav__link">
      Updating
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../matching/" title="Configuring the Matching Service" class="md-nav__link">
      Configuring the Matching Service
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      For Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        For Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev/schemas/" title="Creating or Modifying a Schema" class="md-nav__link">
      Creating or Modifying a Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev/webapp/" title="Modifying the Webapp" class="md-nav__link">
      Modifying the Webapp
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev/matching/" title="Modifying the Matching Service" class="md-nav__link">
      Modifying the Matching Service
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing-the-matching-tool" title="Installing the matching-tool" class="md-nav__link">
    Installing the matching-tool
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-with-docker" title="Deploy with Docker" class="md-nav__link">
    Deploy with Docker
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#production" title="Production" class="md-nav__link">
    Production
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development" title="Development" class="md-nav__link">
    Development
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Installing</h1>
                
                <h2 id="installing-the-matching-tool">Installing the matching-tool<a class="headerlink" href="#installing-the-matching-tool" title="Permanent link">&para;</a></h2>
<h3 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h3>
<ul>
<li>Docker and Docker-Compose; this is not strictly needed, but the only way to install that DSaPP is supporting and documenting.</li>
<li>AWS S3; For development and testing purposes, <a href="#s3-credentials">Moto standalone S3 server</a> can work, but it is not meant for production as the stored S3 data will disappear as soon as the process ends.</li>
</ul>
<h3 id="deploy-with-docker">Deploy with Docker<a class="headerlink" href="#deploy-with-docker" title="Permanent link">&para;</a></h3>
<h4 id="production">Production<a class="headerlink" href="#production" title="Permanent link">&para;</a></h4>
<ol>
<li>Set up a Postgres server. <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_GettingStarted.CreatingConnecting.PostgreSQL.html">Amazon RDS</a> is recommended, though you may set up and administrate your own if desired.</li>
<li>Set up a machine/instance that will run the matching tool. Log into this machine; the rest of the steps assume that you are on the machine.</li>
<li>Clone the git repository: <code>git clone https://github.com/dssg/matching-tool.git</code> (this will require git to be installed if the machine didn't come with it)</li>
<li><code>cd matching-tool</code> to change into the repository root directory.</li>
<li>Run the docker install script. Log out and back in when it completes. <code>./scripts/1_install_docker</code></li>
<li>
<p>Run the database prepare script. This will create a Postgres database and populate the .env file needed to run the docker infrastructure. It requires the following arguments:</p>
<ul>
<li>The address of the running Postgres server from step 1</li>
<li>The port of the running Postgres server from step 1</li>
<li>The name and password of a superuser on the Postgres server from step 1 that can create databases. If you are using Amazon RDS as directed, this user is created as part of the Postgres launch step.</li>
<li>The name of a new database to create for the webapp</li>
</ul>
<p>The script is run like this: <code>./scripts/2_prepare_db PGSERVER PGPORT SUPER_USER NEW_DATABASE</code>
Example: <code>./scripts/2_prepare_db mypostgres.county.gov 5432 postgresadmin matching_tool</code>
In addition to the Postgres database, this will prepopulate a .env file of environment variables that the Docker infrastructure will use.</p>
</li>
<li>
<p>Add AWS environment variables for S3 access:</p>
<ul>
<li>Open up your .env file and modify the <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> variables with your values. Visit <a href="https://docs.aws.amazon.com/general/latest/gr/managing-aws-access-keys.html">Managing Access Keys for your AWS Account</a> if you don't have an access key yet.</li>
<li>Open up the webapp.env file and modify all the instances of <code>your-bucket</code> to an S3 bucket you want to use to store data.</li>
</ul>
</li>
<li>(optional) If you would like the web application to be able to send mail (e.g. for the reset password form), also modify the <code>MAIL_SERVER</code>, <code>MAIL_USERNAME</code>, <code>MAIL_PASSWORD</code>, and <code>MAIL_DEFAULT_SENDER</code> variables. Depending on your mailing setup, <code>MAIL_PORT</code> (default: 465), <code>MAIL_USE_SSL</code> (default: True), <code>MAIL_USE_TLS</code> (default: False) can be overridden. If you don't set any mail environment variables, the reset password form will not work, but the rest of the app will.</li>
<li>(optional) Perform Redis tweaks. This is tested on Ubuntu. For other OSes, the method for making these changes may be different. Also, the need these changes may not be there for all OSes; Ubuntu's default configuration is not ideal for Redis within docker. If you're not sure, when you start up docker-compose in step 4, if Redis throws any warnings, listen to them. It will run without these, but without doing this you may increase the chances for weird system errors.<ul>
<li>Disable Transparent HugePage in the current session: <code>echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</code></li>
<li>Disable Transparent HugePage for future reboots: modify the /etc/rc.local file as root</li>
<li>Enable overcommitt memory: <code>sudo sysctl vm.overcommit_memory=1</code></li>
</ul>
</li>
<li>Initialize the webapp database and create a web user with the <code>create_user</code> script. The script requires the following:<ul>
<li>A short name for your jurisdiction (e.g. 'Cook'). Don't include spaces as it will confuse the script. This is just the name that shows up at the top of the webapp.</li>
<li>An email address for the web app login user</li>
<li>A password for the web app login user</li>
<li>A list of 'event types' that the user will have access to upload (e.g. <code>hmis_service_stays</code>, <code>jail_bookings</code>). If you want to see all the available event types, run the script without any to see the full list (e.g. <code>./scripts/3_create_user</code>)
Example: <code>./scripts/3_create_user mycounty thcrockett@uchicago.edu password hmis_service_stays jail_bookings</code></li>
</ul>
</li>
<li>At this point, the web app should be running at port 80 on the machine.</li>
</ol>
<h4 id="development">Development<a class="headerlink" href="#development" title="Permanent link">&para;</a></h4>
<ol>
<li>Set up needed environment variables.</li>
<li>S3: Ideally, this should be run on an EC2 instance with an IAM role capable of accessing S3. You can totally ignore any S3 environment variables in that case. If not, ensure that you have values for <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> set globally, or any other way that <a href="http://boto3.readthedocs.io/en/latest/guide/configuration.html">boto3 can read</a>.</li>
<li>Flask, Postgres: These are set up by the development docker-compose, so no need to do anything here.</li>
<li>Install <a href="https://docs.docker.com/install/">Docker</a> and <a href="https://docs.docker.com/compose/install/">docker-compose</a></li>
<li>Bring up the docker containers using our development docker-compose: <code>docker-compose up</code></li>
<li>Initialize the database and users. You can use this script to get set up easily, including a user 'testuser@example.com' with password 'password', that you can use to log in: <code>sh scripts/create_test_users_docker.sh</code></li>
</ol>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../users/schemas/hmis-data/" title="Homelessness Service Stays Schema" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Homelessness Service Stays Schema
              </span>
            </div>
          </a>
        
        
          <a href="../troubleshooting/" title="Troubleshooting" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Troubleshooting
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.a59e2a89.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>