



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.2">
    
    
      
        <title>Troubleshooting - Matching Tool</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.ba0fd1a6.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#data-flow-overview" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Matching Tool" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Matching Tool
              </span>
              <span class="md-header-nav__topic">
                Troubleshooting
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/dssg/matching-tool/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Github
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Matching Tool
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/dssg/matching-tool/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Github
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      For Users
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        For Users
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/using/" title="Using the Tool" class="md-nav__link">
      Using the Tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Schemas
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Schemas
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/booking-akaalias-data/" title="Booking AKA/Alias Schema" class="md-nav__link">
      Booking AKA/Alias Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/booking-charging-data/" title="Booking Charge Schema" class="md-nav__link">
      Booking Charge Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/booking-data/" title="Booking Schema" class="md-nav__link">
      Booking Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/by-name-list/" title="By-Name Schema" class="md-nav__link">
      By-Name Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/case-charge-data/" title="Case Charge Schema" class="md-nav__link">
      Case Charge Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/hmis-akaalias-data/" title="Homelessness Services AKA/Alias Schema" class="md-nav__link">
      Homelessness Services AKA/Alias Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../users/schemas/hmis-data/" title="Homelessness Service Stays Schema" class="md-nav__link">
      Homelessness Service Stays Schema
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      For Administrators
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        For Administrators
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../install/" title="Installing" class="md-nav__link">
      Installing
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Troubleshooting
      </label>
    
    <a href="./" title="Troubleshooting" class="md-nav__link md-nav__link--active">
      Troubleshooting
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-flow-overview" title="Data Flow Overview" class="md-nav__link">
    Data Flow Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-troubleshooting-tools" title="General Troubleshooting Tools" class="md-nav__link">
    General Troubleshooting Tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#querying-the-database" title="Querying the Database" class="md-nav__link">
    Querying the Database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-into-a-container" title="Logging into a container" class="md-nav__link">
    Logging into a container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-logs" title="Docker logs" class="md-nav__link">
    Docker logs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login-issues" title="Login Issues" class="md-nav__link">
    Login Issues
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-user-is-unable-to-log-in" title="A user is unable to log in" class="md-nav__link">
    A user is unable to log in
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-user-cannot-see-any-upload-buttons" title="A user cannot see any upload buttons" class="md-nav__link">
    A user cannot see any upload buttons
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upload-issues" title="Upload Issues" class="md-nav__link">
    Upload Issues
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#system-failure" title="System failure" class="md-nav__link">
    System failure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matching-issues" title="Matching Issues" class="md-nav__link">
    Matching Issues
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#matching-failure" title="Matching Failure" class="md-nav__link">
    Matching Failure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#matching-oddities" title="Matching Oddities" class="md-nav__link">
    Matching Oddities
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../updating/" title="Updating" class="md-nav__link">
      Updating
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../matching/" title="Configuring the Matching Service" class="md-nav__link">
      Configuring the Matching Service
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      For Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        For Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev/schemas/" title="Creating or Modifying a Schema" class="md-nav__link">
      Creating or Modifying a Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev/webapp/" title="Modifying the Webapp" class="md-nav__link">
      Modifying the Webapp
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev/matching/" title="Modifying the Matching Service" class="md-nav__link">
      Modifying the Matching Service
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-flow-overview" title="Data Flow Overview" class="md-nav__link">
    Data Flow Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-troubleshooting-tools" title="General Troubleshooting Tools" class="md-nav__link">
    General Troubleshooting Tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#querying-the-database" title="Querying the Database" class="md-nav__link">
    Querying the Database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-into-a-container" title="Logging into a container" class="md-nav__link">
    Logging into a container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-logs" title="Docker logs" class="md-nav__link">
    Docker logs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login-issues" title="Login Issues" class="md-nav__link">
    Login Issues
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-user-is-unable-to-log-in" title="A user is unable to log in" class="md-nav__link">
    A user is unable to log in
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-user-cannot-see-any-upload-buttons" title="A user cannot see any upload buttons" class="md-nav__link">
    A user cannot see any upload buttons
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upload-issues" title="Upload Issues" class="md-nav__link">
    Upload Issues
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#system-failure" title="System failure" class="md-nav__link">
    System failure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matching-issues" title="Matching Issues" class="md-nav__link">
    Matching Issues
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#matching-failure" title="Matching Failure" class="md-nav__link">
    Matching Failure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#matching-oddities" title="Matching Oddities" class="md-nav__link">
    Matching Oddities
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/dssg/matching-tool/edit/master/docs/admin/troubleshooting.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Troubleshooting</h1>
                
                <p>This document's goal is to familiarize matching tool administrators with the right places to look to investigate problems that come up in a deployment of the matching tool. </p>
<h3 id="data-flow-overview">Data Flow Overview<a class="headerlink" href="#data-flow-overview" title="Permanent link">&para;</a></h3>
<p>To help with general troubleshooting, it helps to gain some familiarity with how data flows through the application and different containers. Below is a step-by-step overview of data flow.</p>
<ol>
<li>The user uploads a tabular dataset through the webapp UI, which is run by the <code>webapp</code> container. This data goes through the <a href="https://github.com/dssg/matching-tool/blob/master/webapp/backend/apis/upload.py#L299">upload_file</a> endpoint and is immediately saved to a temporary directory on the filesystem that is shared with the <code>webapp_worker</code> container. It tells the <code>webapp_worker</code> container to validate the file asynchronously and begins polling the asynchronous job for results.</li>
<li>The <code>webapp_worker</code> container runs the <a href="https://github.com/dssg/matching-tool/blob/master/webapp/backend/apis/upload.py#L193">validate_async</a> function asynchronously. This saves some metadata about the upload to the <code>upload_log</code> Postgres table and runs a variety of validations on the data. It culminates in uploading the validated and transformed file to storage (S3 by default) at the <a href="https://github.com/dssg/matching-tool/blob/master/webapp.env">RAW_UPLOADS_PATHs</a> location, and returns the validation results.</li>
<li>Assuming the file has no validation problems and the user clicks 'confirm upload', the <a href="https://github.com/dssg/matching-tool/blob/master/webapp/backend/apis/upload.py#L337">merge_file</a> endpoint is called. This loads the stored file into the database under the path <code>raw_{upload_id}</code> and merges it with the 'master' table for the relevant jurisdiction and event type.
<br /><br />This 'master' table serves as the source for the results dashboard. Data is sent from here to the matcher, and data from the matcher is synced back into it. The 'merge' consists of adding rows from the new uploaded file that do not have their primary keys (see primaryKey attribute of the relevent <a href="https://github.com/dssg/matching-tool/tree/master/webapp/schemas/uploader">schema file</a> present in the master table, and updating data in the master table with any matching rows from the upload. Placeholder matching ids (of format {event_type}_{internal_person_id}) are populated.
 <br /><br />The 'master' table is exported to storage (at <a href="https://github.com/dssg/matching-tool/blob/master/webapp.env">MERGED_UPLOADS_PATH</a>) and the <code>matcher_worker</code> container is notified (via the <a href="https://github.com/dssg/matching-tool/blob/master/matcher/matcher/tasks.py">do_match</a> function) to begin matching asynchronously.</li>
<li>The <code>matcher_container</code> loads <em>all</em> master tables from storage for matching.  It loads the <a href="https://github.com/dssg/matching-tool/blob/master/matcher/matcher_config.yaml">matcher_config.yaml</a> file in the container for configuration. The internals of the matching algorithm are outside of the scope of this document, but its data output is written to storage (at <a href="https://github.com/dssg/matching-tool/blob/master/webapp.env">BASE_PATH/matched</a>) , and the <code>webapp_worker</code> is notified of the completed matching job.</li>
<li>The <code>webapp_worker</code> container runs the <a href="https://github.com/dssg/matching-tool/blob/master/matcher/matcher/tasks.py">match_finished</a> function to merge the matched data into the <code>master</code> table. The new data is loaded into a temporary table again and joined with the <code>master</code> table on the primary key again, this time just uploading the matched_id column with the new values from the matcher.</li>
<li>As the user queries the results dashboard, the <code>master</code> table is queried.</li>
</ol>
<h3 id="general-troubleshooting-tools">General Troubleshooting Tools<a class="headerlink" href="#general-troubleshooting-tools" title="Permanent link">&para;</a></h3>
<p>Below are several general tools you can use to diagnose a variety of problems. These are referred to by many of the specific use cases further down in this document.</p>
<h4 id="querying-the-database">Querying the Database<a class="headerlink" href="#querying-the-database" title="Permanent link">&para;</a></h4>
<p>On installation, Postgres credentials were created and put in <code>webapp.env</code>. Some troubleshooting problems may involve looking in this database. Setting up a database query tool is outside of the scope of this tutorial, but common options are <a href="https://dbeaver.io/">DBeaver</a> or <a href="https://help.ubuntu.com/community/PostgreSQL#Client_Installation">psql</a> (psql can be installed directly on the server).</p>
<h4 id="logging-into-a-container">Logging into a container<a class="headerlink" href="#logging-into-a-container" title="Permanent link">&para;</a></h4>
<p>Occasionally you may need to gain access to a shell prompt on one of the containers. You can do so with <code>docker exec -it &lt;containername&gt; /bin/bash</code>.</p>
<h4 id="docker-logs">Docker logs<a class="headerlink" href="#docker-logs" title="Permanent link">&para;</a></h4>
<p>Many, many troubleshooting tasks involve looking at application logs. Docker keeps track of the logs from individual docker containers and you can view them with the <code>docker logs</code> command. Try <code>docker logs --help</code> to look at all the options available to filter the logs from a specific container. Beware: some of the containers output a lot of log messages, so you won't want to run them without filtering!</p>
<h3 id="login-issues">Login Issues<a class="headerlink" href="#login-issues" title="Permanent link">&para;</a></h3>
<h4 id="a-user-is-unable-to-log-in">A user is unable to log in<a class="headerlink" href="#a-user-is-unable-to-log-in" title="Permanent link">&para;</a></h4>
<p>If you have created a user (see <a href="../updating/">Updating the Tool</a>) but they cannot log in, you can query the webapp's <a href="./#querying-the-database">Postgres database</a>. The user information is kept in the <code>public</code>.<code>user</code> table (with their role memberships in the <code>public</code>.<code>roles_users</code> table). That table should have an row with their email address in it. If not, their user was not successfully created and you should <a href="../updating/">create their user</a> again. If they do have a row, ensure that they are logging in with the correct email address. Otherwise there may be a password issue. Although you cannot retrieve their raw password, you may remove their <code>user</code> and <code>roles_users</code> records and create a user with a fresh password for them again. Also, if you have configured the installation to be able to reset passwords (see <a href="../install/">Installation</a> step 8), they may reset their password through the login page.</p>
<h4 id="a-user-cannot-see-any-upload-buttons">A user cannot see any upload buttons<a class="headerlink" href="#a-user-cannot-see-any-upload-buttons" title="Permanent link">&para;</a></h4>
<p>If a user can log in but cannot see any event type buttons (e.g. HMIS service stays, jail bookings) on the upload page, it means they are not a member of any roles. You can query the webapps' <a href="./#querying-the-database">Postgres database</a> <code>public</code>.<code>roles_users</code> table joined to the <code>role</code> and <code>user</code> tables to see what roles they are a member of.</p>
<pre><code class="sql">SELECT role.name
FROM &quot;user&quot;
JOIN &quot;roles_users&quot; ON (&quot;user&quot;.id = &quot;roles_users&quot;.user_id)
JOIN &quot;role&quot; ON (&quot;role&quot;.id = &quot;roles_users&quot;.role_id)
WHERE email = 'thcrockett@uchicago.edu';
</code></pre>

<pre><code>name            
----------------------------
default_hmis_service_stays
default_jail_bookings
(2 rows)
</code></pre>

<p>In this example, the user <code>thcrockett@uchicago.edu</code> has access to the <code>default_hmis_service_stays</code> and <code>default_jail_bookings</code> roles, which in matching tool parlance translates to <code>hmis_service_stays</code> and <code>jail_bookings</code> event types for the jurisdiction named <code>default</code>. This user should be seeing buttons on the upload page for both of those event types.</p>
<p>If the user does not have entries here, you may add them, either through the <a href="../updating/">create user script</a> or through directly modifying the database.</p>
<p>If the user <em>does</em> have entries here, refer to the <a href="./#docker-logs">docker logs</a> in the webapp container around when they were using the application. A possible cause of this problem is if the event types they are a part of don't match the schemas listed by the app. For the most up to date list of event types, refer to <code>webapp/schemas/uploader/</code>. The filenames in that directory (dashes replaced with underscores) are queried by the app and make up a whitelist of event types. Any event type the user is associated with that doesn't match that list will be ignored by the application.</p>
<h3 id="upload-issues">Upload Issues<a class="headerlink" href="#upload-issues" title="Permanent link">&para;</a></h3>
<h4 id="system-failure">System failure<a class="headerlink" href="#system-failure" title="Permanent link">&para;</a></h4>
<p>Although the majority of messages that users will see coming from the upload portion of the tool should be <em>validation</em> errors (user-fixable, referenced in the <a href="../../users/using/">Users</a> section of the guide), occasionally they may see a message that indicates a 'System Failure'/'System Error' and they need to come to you for help. In this case, there is something that failed during the upload process in a way that the system did not expect. You should look at the <a href="./#docker-logs">docker logs</a> for both the webapp and <code>webapp_worker</code> containers that cover the period that the user was using the tool. If there's a lot of output, you can filter to 'ERROR' messages (e.g. <code>docker logs webapp | grep ERROR</code>), though often the messages surrounding an error message will give helpful context.</p>
<h3 id="matching-issues">Matching Issues<a class="headerlink" href="#matching-issues" title="Permanent link">&para;</a></h3>
<h4 id="matching-failure">Matching Failure<a class="headerlink" href="#matching-failure" title="Permanent link">&para;</a></h4>
<p>If a user reports that the app's timeline indicates that a matching job failed, you can look at the <a href="./#docker-logs">docker logs</a> for the <code>matcher_worker</code> container. Warning: The matcher outputs a <strong>lot</strong> of log messages, you will likely want to heavily filter the logs. For instance, just looking at the last 100 lines or so (e.g. <code>docker logs matcher_worker --tail 100</code> would let you see any errors that were thrown and stopped the matching job.</p>
<h4 id="matching-oddities">Matching Oddities<a class="headerlink" href="#matching-oddities" title="Permanent link">&para;</a></h4>
<p>Sometimes, the matching process may complete but the results look weird. Often this may show itself in the form of matching results being far lower than expected, and is corroborated by placeholder match ids (the placeholder format is <code>{event_type}_{person_id}</code>, e.g. <code>hmis_service_stays_123897124</code> showing up in the webapp results dashboard. This means that the database table that the webapp uses to populate the dashboard did not receive all of the rows of matching results it expected to receive. The reasons for this can be divided into two possibilities: Either the matcher's results (that are saved to S3) were incorrect, or they were loaded incorrectly. To find out which, compare the length of the matcher's results to the length of the corresponding database table. The matcher's results are located under the <code>BASE_PATH</code> (defined webapp.env)/matched key/file. The database <a href="./#querying-the-database">table to query</a> is <code>{jurisdiction}_{event_type}_master</code>.</p>
<ul>
<li>If the matcher results are shorter, then a problem happened with the matching service or prior to that. You can perform the same type of length check on the matcher's input at <code>BASE_PATH/merged</code> to ensure that the matcher received the correct length dataset.<ul>
<li>If the matcher's input and output are not the same length, you will have to dig into the matcher logs. </li>
<li>If the matcher's input and output are the same length, then a problem happened while exporting the master table to place where the matcher reads it. Check the <code>webapp</code> logs for any errors that may have happened while doing this.</li>
</ul>
</li>
<li>If the results are the same length, then a problem happened while joining the matching results into the database. Check the <code>webapp_worker</code> logs for any messages that match those under the (match_finished)[https://github.com/dssg/matching-tool/blob/master/webapp/webapp/tasks.py#L395-L430] code path. </li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../install/" title="Installing" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Installing
              </span>
            </div>
          </a>
        
        
          <a href="../updating/" title="Updating" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Updating
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.a59e2a89.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>